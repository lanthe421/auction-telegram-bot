# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ª–æ—Ç–æ–≤

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ **–ª–æ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ**. –ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –ª–æ—Ç–æ–≤.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–æ—Ç–æ–≤:

1. **`lot:`** - –¥–ª—è –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –ª–æ—Ç—ã

   ```python
   @router.callback_query(F.data.startswith("lot:"))
   async def show_lot_details(callback: CallbackQuery):  # ‚ùå –ë–ï–ó state
   ```

2. **`lot_details:`** - –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"
   ```python
   @router.callback_query(F.data.startswith("lot_details:"))
   async def show_lot_details_from_back_button(callback: CallbackQuery, state: FSMContext):  # ‚úÖ –° state
   ```

### –ü—Ä–æ–±–ª–µ–º–∞:

- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `lot:` –Ω–µ –∏–º–µ–ª –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `state: FSMContext`
- –≠—Ç–æ –º–æ–≥–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ FSM –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ª–æ—Ç–∞

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `lot:`

**–§–∞–π–ª:** `bot/handlers/auction.py`

**–ë—ã–ª–æ:**

```python
@router.callback_query(F.data.startswith("lot:"))
async def show_lot_details(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ª–æ—Ç–∞"""
    lot_id = int(callback.data.split(":")[1])
    await _render_lot_details(callback, lot_id)
```

**–°—Ç–∞–ª–æ:**

```python
@router.callback_query(F.data.startswith("lot:"))
async def show_lot_details(callback: CallbackQuery, state: FSMContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ª–æ—Ç–∞"""
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
    from bot.utils.fsm_utils import clear_bid_state_if_needed

    if await clear_bid_state_if_needed(state):
        logger.info(
            f"–û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {callback.from_user.id} –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ª–æ—Ç–∞"
        )

    lot_id = int(callback.data.split(":")[1])
    await _render_lot_details(callback, lot_id)
```

## üéØ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `state: FSMContext`**

- –¢–µ–ø–µ—Ä—å –æ–±–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ª–æ—Ç–æ–≤ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM**

- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ª–æ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏

### 3. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ—É–Ω–∫—Ü–∏–π

```
üìã show_lot_details —Å–∏–≥–Ω–∞—Ç—É—Ä–∞: (callback: CallbackQuery, state: FSMContext)
üìã show_lot_details_from_back_button —Å–∏–≥–Ω–∞—Ç—É—Ä–∞: (callback: CallbackQuery, state: FSMContext)
üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã show_lot_details: ['callback', 'state']
‚úÖ –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä state
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–û—Ç–∫—Ä—ã—Ç–∏–µ –ª–æ—Ç–∞ –ø–æ —Å—Å—ã–ª–∫–µ**

   - ‚úÖ –õ–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–æ–ª–∂–Ω–æ –æ—á–∏—â–∞—Ç—å—Å—è (–µ—Å–ª–∏ –±—ã–ª–æ)

2. **–ù–∞–∂–∞—Ç–∏–µ "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É**

   - ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
   - ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–æ–ª–∂–Ω–æ –æ—á–∏—â–∞—Ç—å—Å—è

3. **–ö–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ª–æ—Ç–∞**
   - ‚úÖ `/start`, `/support`, `/my_bids` –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
   - ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ "–Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã"

## üìÅ –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `bot/handlers/auction.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `lot:`

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –æ—Ç–∫—Ä—ã—Ç–∏–µ –ª–æ—Ç–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"
4. **–£–±–µ–¥–∏—Ç—å—Å—è** –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫ FSM

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã** –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤** –ø–æ–º–æ–∂–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ª–∞–¥–∫–∏

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:

- **–ò–º–ø–æ—Ä—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** - —É—Å–ø–µ—à–µ–Ω
- **–°–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã state** - –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ–±–µ–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **–°–∏–Ω—Ç–∞–∫—Å–∏—Å** - –±–µ–∑ –æ—à–∏–±–æ–∫

### üîß –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–æ—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.** ‚úÖ
