# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ FSM

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### üêõ –ë–ê–ì

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É **"–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Å—É–º–º—É"** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏, –Ω–æ –Ω–µ –≤–≤–æ–¥–∏—Ç —Å—É–º–º—É –∏ –Ω–∞–∂–∏–º–∞–µ—Ç **"–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"**. –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM (Finite State Machine) –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è, –∏ –ª—é–±–∞—è —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/support`, `/start`, `/my_bids`) –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –±–æ—Ç–æ–º –∫–∞–∫ –ø–æ–ø—ã—Ç–∫–∞ –≤–≤–µ—Å—Ç–∏ —Å—Ç–∞–≤–∫—É, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ **"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã"**.

### üîÑ –°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Å—É–º–º—É"
2. –ë–æ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `BidStates.waiting_for_bid_amount`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –≤–≤–æ–¥–∏—Ç —Å—É–º–º—É
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"
5. –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM –ù–ï –æ—á–∏—â–∞–µ—Ç—Å—è
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—É `/support`
7. –ë–æ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç `/support` –∫–∞–∫ —Å—Ç–∞–≤–∫—É
8. –ë–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –æ—à–∏–±–∫—É "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã"

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å FSM

**–§–∞–π–ª:** `bot/utils/fsm_utils.py`

```python
async def clear_bid_state_if_needed(state: FSMContext) -> bool:
    """–û—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏."""

async def get_current_state_name(state: FSMContext) -> Optional[str]:
    """–ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM."""

async def is_in_bid_state(state: FSMContext) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏."""
```

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–ª—é—á–µ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

#### 1. –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"

**–§–∞–π–ª:** `bot/handlers/auction.py`

```python
@router.callback_query(F.data.startswith("lot_details:"))
async def show_lot_details_from_back_button(callback: CallbackQuery, state: FSMContext):
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
    from bot.utils.fsm_utils import clear_bid_state_if_needed
    if await clear_bid_state_if_needed(state):
        logger.info(f"–û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {callback.from_user.id}")
```

#### 2. –ö–æ–º–∞–Ω–¥–∞ `/start`

**–§–∞–π–ª:** `bot/handlers/auction.py`

```python
@router.message(Command("start"))
async def cmd_start(message: Message, state: FSMContext):
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
    from bot.utils.fsm_utils import clear_bid_state_if_needed
    if await clear_bid_state_if_needed(state):
        logger.info(f"–û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
```

#### 3. –ö–æ–º–∞–Ω–¥–∞ `/support`

**–§–∞–π–ª:** `bot/handlers/support.py`

```python
@router.message(Command("support"))
async def support_command(message: Message, state: FSMContext):
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
    from bot.utils.fsm_utils import clear_bid_state_if_needed
    if await clear_bid_state_if_needed(state):
        logger.info(f"–û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
```

#### 4. –ö–æ–º–∞–Ω–¥–∞ `/my_bids`

**–§–∞–π–ª:** `bot/handlers/bids.py`

```python
@router.message(Command("my_bids"))
async def my_bids(message: Message, state: FSMContext):
    # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
    from bot.utils.fsm_utils import clear_bid_state_if_needed
    if await clear_bid_state_if_needed(state):
        logger.info(f"–û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
```

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
INFO - –û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM: BidStates:waiting_for_bid_amount
INFO - –û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456789 –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ '–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É'
INFO - –û—á–∏—â–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123456789 –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ /support
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. **–ù–∞–∂–∞—Ç–∏–µ "–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Å—É–º–º—É"** ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
2. **–ù–∞–∂–∞—Ç–∏–µ "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É"** ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç—Å—è
3. **–í–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `/support`** ‚Üí –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–í–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `/start`** ‚Üí –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. **–í–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `/my_bids`** ‚Üí –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚ùå **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –û—à–∏–±–∫–∞ "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—É–º–º—ã"
- ‚úÖ **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** - –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

## üìÅ –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `bot/utils/fsm_utils.py` - –Ω–æ–≤–∞—è —É—Ç–∏–ª–∏—Ç–∞
- ‚úÖ `bot/utils/__init__.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç—ã
- ‚úÖ `bot/handlers/auction.py` - –æ—á–∏—Å—Ç–∫–∞ –≤ –∫–Ω–æ–ø–∫–µ "–ù–∞–∑–∞–¥" –∏ /start
- ‚úÖ `bot/handlers/support.py` - –æ—á–∏—Å—Ç–∫–∞ –≤ /support
- ‚úÖ `bot/handlers/bids.py` - –æ—á–∏—Å—Ç–∫–∞ –≤ /my_bids

---

**üêõ –ë–ê–ì –ò–°–ü–†–ê–í–õ–ï–ù!** ‚úÖ

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –∫ –ª–æ—Ç—É" –±–µ–∑ –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏.
