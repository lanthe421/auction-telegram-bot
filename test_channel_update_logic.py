#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Å—Ç–∞–≤–∫–∞—Ö
"""

import os
import sys
from datetime import datetime

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from bot.utils.auto_bid_manager import AutoBidManager
from database.db import SessionLocal, init_db
from database.models import AutoBid, Bid, Lot, LotStatus, User


def test_channel_update_logic():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞"""
    print("üß™ –¢–ï–°–¢ –õ–û–ì–ò–ö–ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ö–ê–ù–ê–õ–ê")
    print("=" * 50)

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    try:
        init_db()
        print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        return

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
    print("\nüìä –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞:")

    test_cases = [
        (1000, 1100, "10% –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (1000, 2000, "100% –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (1000, 1050, "5% –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –ù–ï –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (10000, 10900, "9% –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –Ω–æ 900‚ÇΩ - –ù–ï –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (10000, 11000, "10% –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (1000, 2001, "1001‚ÇΩ –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
        (1000, 1999, "999‚ÇΩ –∏–∑–º–µ–Ω–µ–Ω–∏–µ - –ù–ï –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è"),
    ]

    for old_price, new_price, description in test_cases:
        should_update = AutoBidManager._should_update_channel(1, old_price, new_price)
        status = "‚úÖ –î–ê" if should_update else "‚ùå –ù–ï–¢"
        print(f"   {status} | {old_price}‚ÇΩ ‚Üí {new_price}‚ÇΩ | {description}")

    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print("üìã –¢–µ–ø–µ—Ä—å –∫–∞–Ω–∞–ª –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö")


if __name__ == "__main__":
    test_channel_update_logic()
